<html>

<head>
  <script type="module">
  </script>
  <style type="text/css">
    html {
      background-color: #000;
    }

    #editor {
      position: absolute;
      top: 50px;
      bottom: 0;
      left: 0;
      right: 50%;
    }

    #output {
      position: absolute;
      left: 50%;
      top: 50px;
      bottom: 0;
      right: 0;
      color: #fff;
    }
  </style>
</head>

<body>
  <button id="run">Run</button>
  <div id="editor"></div>
  <code id="output"></code>
  <script src="https://cdn.jsdelivr.net/npm/ace-builds@1.37.5/src-noconflict/ace.js" charset="utf-8"></script>
  <script type="module">
    import init, {init_panic_hook, run_source} from "./rain/rain.js";

    const editor = ace.edit("editor");
    editor.setTheme("ace/theme/twilight");
    editor.session.setMode("ace/mode/rust");

    async function initialize() {
      await init();
      init_panic_hook();
    }
    initialize();

    function set_output(s) {
      console.log([s]);
      const elem = document.querySelector("#output");
      elem.textContent = s;
      elem.innerHTML = elem.innerHTML.replace(/\n/g, '<br/>').replace(/ /g, '&nbsp;');
    }

    document.querySelector("#run").addEventListener("click", () => {
      const source = editor.getValue();
      try {
        const output = run_source(source);
        console.log(output);
        set_output(output.prints + "\n\n" + output.output);
      } catch (err) {
        set_output(err);
      }
    });
  </script>

</body>

</html>